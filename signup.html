<!DOCTYPE html>
<html data-bs-theme="light" lang="en" style="width: 100%">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, shrink-to-fit=no" />
    <title>Sign Up</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,100..1000;1,9..40,100..1000&display=swap" rel="stylesheet" />
    <script src="https://kit.fontawesome.com/f99dffaa0d.js" crossorigin="anonymous"></script>

    <!-- Bootstrap JS and Popper.js (required for Bootstrap) -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <!-- Firebase JS SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js" type="module"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js" type="module"></script>
    <link rel="stylesheet" href="signup.css" />
  </head>

  <body>
    <section class="position-relative" style="padding: 5%">
      <div class="card" style="width: 100%; height: 100%; border-radius: 26px">
        <div class="row" style="width: auto; height: auto; margin: 0px">
          <div class="col" style="width: 100%; height: 100%; margin: auto">
            <form class="text-center" id="signupForm" method="post" style="position: relative; transform: translate(-247px); width: 70%; height: 100%; padding-left: 30%">
              <h1 style="text-align: left; font-weight: bold; padding-bottom: 5%; line-height: 1">Create an Account</h1>

              <div class="container" style="width: 500px">
                <!-- Name input -->
                <div class="row g-3">
                  <div class="col">
                    <div class="mb-3">
                      <input class="form-control name-input" type="text" name="firstName" id="firstName" placeholder="First Name" />
                    </div>
                  </div>
                  <div class="col">
                    <div class="mb-4">
                      <input class="form-control name-input" type="text" name="lastName" id="lastName" placeholder="Last Name" />
                    </div>
                  </div>
                </div>
                <div class="row g-3">
                  <input class="form-control name-input mb-4" type="email" name="email" id="inputEmail" placeholder="Email" />
                  <div class="error-message" id="emailErrorMessage"></div>
                </div>

                <div class="row g-3">
                  <input class="form-control text-input" type="date" name="birthday" id="birthday" placeholder="Birthday" />
                </div>

                <div class="row g-3 password-container">
                  <input class="form-control text-input" type="password" name="password" id="inputPassword" placeholder="Password" />
                  <i class="far fa-eye-slash show-password-btn" id="showPasswordBtn"></i> 
                </div>

                <div class="error-message" id="passwordErrorMessage"></div>

                <div class="row g-3 password-container">
                  <input class="form-control text-input" type="password" name="confirmPassword" id="confirmPassword" placeholder="Confirm Password" />
                  <i class="far fa-eye-slash show-password-btn" id="showCfmPasswordBtn"></i>
                </div>
                
                <div class="error-message" id="passwordConfirmErrorMessage"></div>

                <div class="row">
                  <button class="submit-btn" type="submit" style="position: sticky; transform: translate(86%)">Create Account</button>
                  <a href = 'login.html'>Already have an account?</a>
                </div>


                <div class="row mt-3">
                  <p class="text-muted">OR</p>
                </div>

                <div class="row card google-card m-auto" id="signup_google">
                  <div class="card-body google-card-body">
                    <i class="fa-brands fa-google fa-l google-icon" style="margin-right: 0px" 0px;></i>
                    <h6 class="text-white card-subtitle mb-2 google-text">Continue with Google</h6>
                  </div>
                </div>
              </div>
            </form>
          </div>

          <!-- Image Carousel -->
          <div class="col-md-6 col-xl-4 my-5 pe-5" style="border-radius: 20px">
            <div class="carousel slide" data-bs-ride="carousel" id="carousel-1">
              <div class="carousel-inner" style="border-radius: 26px; border-style: solid">
                <!-- Carousel Indicators (Dots) -->
                <ol class="carousel-indicators" style="list-style-type: none">
                  <li data-bs-target="#carousel-1" data-bs-slide-to="0" class="active"></li>
                  <li data-bs-target="#carousel-1" data-bs-slide-to="1"></li>
                  <li data-bs-target="#carousel-1" data-bs-slide-to="2"></li>
                </ol>

                <div class="carousel-item active">
                  <img class="w-100 d-block" src="https://source.unsplash.com/random/800x600/?technology" alt="Slide Image" style="height: 602px; width: 650px" />
                </div>
                <div class="carousel-item">
                  <img class="w-100 d-block" src="https://source.unsplash.com/random/800x600/?nature" alt="Slide Image" style="height: 602px; width: 650px" />
                </div>
                <div class="carousel-item">
                  <img class="w-100 d-block" src="https://source.unsplash.com/random/800x600/?animals" alt="Slide Image" style="height: 602px; width: 650px" />
                </div>
              </div>

              <button class="carousel-control-prev" type="button" data-bs-target="#carousel-1" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
              </button>
              <button class="carousel-control-next" type="button" data-bs-target="#carousel-1" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </section>
  </body>

  <script>
    document.getElementById("showPasswordBtn").addEventListener("click", function() {
    togglePasswordVisibility("inputPassword", "showPasswordBtn");
});

document.getElementById("showCfmPasswordBtn").addEventListener("click", function() {
    togglePasswordVisibility("confirmPassword", "showCfmPasswordBtn");
});

function togglePasswordVisibility(inputId, buttonId) {
    var passwordInput = document.getElementById(inputId);
    var showPasswordBtn = document.getElementById(buttonId);

    if (passwordInput.type === "password") {
        passwordInput.type = "text";
        showPasswordBtn.classList.remove("far", "fa-eye-slash");
        showPasswordBtn.classList.add("far", "fa-eye");
    } else {
        passwordInput.type = "password";
        showPasswordBtn.classList.remove("far", "fa-eye");
        showPasswordBtn.classList.add("far", "fa-eye-slash");
    }
}
  </script>

  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-analytics.js";
    import { getDatabase, ref, set, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";
    import { GoogleAuthProvider, signInWithPopup } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBasI3Cfcv2NuSSdL9rUI__pYs-xUN7nm8",
      authDomain: "csad-restaurant-pos.firebaseapp.com",
      databaseURL: "https://csad-restaurant-pos-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "csad-restaurant-pos",
      storageBucket: "csad-restaurant-pos.appspot.com",
      messagingSenderId: "964704635393",
      appId: "1:964704635393:web:7a616e7814cb9c42348e00",
      measurementId: "G-SW0P8CW3WQ",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const database = getDatabase(app);
    const auth = getAuth();

    document.getElementById("signupForm").addEventListener("submit", (e) => {
      e.preventDefault(); // Prevent default form submission, as you want to handle Firebase submission

      var firstName = document.getElementById("firstName").value;
      var lastName = document.getElementById("lastName").value;
      var email = document.getElementById("inputEmail").value;
      var birthday = document.getElementById("birthday").value;
      var password = document.getElementById("inputPassword").value;
      var confirmPassword = document.getElementById("confirmPassword").value;

      // Check if passwords match
      if (password !== confirmPassword) {
        document.getElementById("passwordConfirmErrorMessage").innerText = "Passwords do not match.";
        return;
      }

      // Authentication
      createUserWithEmailAndPassword(auth, email, password)
        .then((userCredential) => {
          // Account created
          const user = userCredential.user;
          console.log("User created: ", user);

          // Save additional user data
          set(ref(database, "users/" + user.uid), {
            firstName: firstName,
            lastName: lastName,
            fullName: "",
            email: email,
            birthday: birthday,
            phone: "",
            bio: "",
            points: 0,
          });

          alert("User created!");
          window.location.href = 'login.html';
        })
        .catch((error) => {
          const errorCode = error.code;
          const errorMessage = error.message;

          alert(errorMessage);
          // ..
        });
    });

    document.getElementById("signup_google").addEventListener("click", (e) => {
      e.preventDefault(); // Prevent default form submission handling

      const provider = new GoogleAuthProvider();
      let email;

      signInWithPopup(auth, provider)
        .then((result) => {
          // This gives you a Google Access Token. You can use it to access the Google API.
          const credential = GoogleAuthProvider.credentialFromResult(result);
          const token = credential.accessToken;
          // The signed-in user info.
          const user = result.user;
          // IdP data available using getAdditionalUserInfo(result)
        //   email = user.email;
        //   name = user.name;
          const { displayName, email, uid } = user;
          const [firstName, lastName] = displayName.split('');

          // Save additional user data
          set(ref(database, "users/" + user.uid), {
            firstName: firstName,
            lastName: lastName,
            email: email,
            fullName: "",
            birthday: birthday,
            phone: "",
            bio: "",
            points: 0,
          });
          alert("User has been signed up via Google!");
          window.location.href = 'login.html';
          // ...
        })
        .catch((error) => {
          // Handle Errors here.
          const errorCode = error.code;
          const errorMessage = error.message;
          // The email of the user's account used.
          const email = error.customData.email;
          // The AuthCredential type that was used.
          const credential = GoogleAuthProvider.credentialFromError(error);
          // ...
        });
    });

    const user = auth.currentUser;
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // User is signed in, see docs for a list of available properties
        // https://firebase.google.com/docs/reference/js/auth.user
        const uid = user.uid;
        // ...
      } else {
        // User is signed out
        // ...
      }
    });
  </script>
</html>
